## 프로젝트명
- Farneback 광학 흐름 기반 해상 위험 객체 탐지
  
## 프로젝트 목표
- 소형 선박이나 해양 부유물을 주야간 카메라를 이용해 감지하고 분석하는 기술 개발
---
## 1. 아이디어 제안 배경 및 목표
- 해상 환경에서의 안전사고 예방은 단순한 기술 보조의 차원을 넘어, 인명과 자산을 보호하기 위한 해상 안전 패러다임의 근본적인 전환을 의미한다. 특히 대형 선박 운항 시 발생하는 강한 와류와 물보라는 소형 선박의 전복을 초래하거나, 해양 부유물이 추진기에 흡입되는 사고의 직접적인 원인이 된다. 이러한 위험 요소를 사전에 인지하는 것은 해상 안전의 핵심이다.
  
- 기존의 단일 프레임(Single-frame) 영상 분석 방식은 개별 이미지의 형태적 특징에 의존하는 한계가 있다. 이로 인해 불규칙하게 확산되며 형태가 가변적인 물보라 노이즈를 실제 객체로 오인하는 고질적인 오탐지 문제가 발생한다. 이러한 기술적 결함은 극한의 해상 환경에서 시스템의 신뢰도를 저하시키는 결정적인 요인이 되어 왔다.
  
<img width="526" height="89" alt="image" src="https://github.com/user-attachments/assets/b3ea9577-3bef-4ba4-a0f2-86f92515eff7" />

- 연구 초기에는 픽셀 단위의 정밀한 광학 흐름(Optical Flow) 추출을 위해 딥러닝 기반의 RAFT(Recurrent All-Pairs Field Transforms) 아키텍처를 검토하였다. RAFT는 높은 정밀도를 보장하나, 반복적 업데이트(Iterative Update) 구조로 인해 연산 부하가 극심하다는 단점이 있다. 실제 NVIDIA RTX 3090 기반 환경에서도 처리 속도가 10~20 FPS 수준에 머물렀으며, 이는 실시간 탐지의 임계치인 30 FPS를 충족하지 못하는 병목(Bottleneck) 현상을 야기했다. 또한, 대규모 모델 가중치를 VRAM에 지속적으로 할당해야 하는 물리적 제약은 Jetson과 같은 저전력 임베디드 하드웨어 환경에서 시스템의 확장성과 실용성을 저해하는 주요 원인이 되었다
  
- 따라서 본 연구는 거친 와류와 악천후 환경에서도 소형 선박 및 부유물을 정밀하게 식별할 수 있는 지능형 안전 시스템 구축을 최종 목표로 설정하였다. 실시간성을 보장함과 동시에 노이즈에 강건한 시공간 특징 융합 아키텍처를 설계하여, 실제 해상 환경에서 즉각적인 위험 대응이 가능한 실무적 탐지 솔루션을 제안하고자 한다.
  
## 2. 창의적 해결 아이디어 및 차별성 
- 본 연구의 핵심은 범용 알고리즘을 해양 환경의 특수성에 맞춰 하드웨어-소프트웨어 공동 설계(Hardware-Software Co-design) 관점에서 최적화한 데 있다. 특히, 제한된 자원을 가진 임베디드 환경에서 고성능 연산을 수행하기 위해 다음과 같은 전략적 설계를 채택하였다.
  
- 실시간성 확보를 위한 Farneback 알고리즘 전환
<img width="387" height="267" alt="image" src="https://github.com/user-attachments/assets/00f511c5-c776-4b8b-9fb1-7e88eaf7bcd1" />

  - 실시간 해상 안전 시스템 구현을 위해 초기 RAFT 모델의 연산 한계를 분석하고, 이를 Farneback 알고리즘으로 대체하였다. 이러한 기술적 전환의 논리적 근거는 네 가지로 요약된다. 첫째, 다항식 전개(Polynomial Expansion) 기반의 Farneback은 전처리 연산을 획기적으로 단축하여 파이프라인 전체가 30 FPS 이상의 실시간성을 유지하도록 지원한다. 둘째, 별도의 딥러닝 가중치를 로드하지 않고 OpenCV 라이브러리 수준에서 구동되므로 임베디드 장비의 고질적인 메모리 부족(OOM) 문제를 원천 차단한다. 셋째, 피라미드 다운샘플링(Pyramid Downsampling) 기법을 통해 지엽적인 물보라 노이즈를 효과적으로 여과하며 객체의 전역적인 움직임을 포착한다. 마지막으로, 결정론적(Deterministic) 연산 방식을 통해 모델 성능 향상의 기여도가 순수하게 광학 흐름 정보에 있음을 수치적으로 증명할 수 있는 아키텍처 투명성을 확보하였다.
   
 - 해상 환경 적합성에 대한 수학적 고찰
  - Farneback 알고리즘은 각 이미지 패치의 픽셀 구조를 다음과 같은 2차 다항식 모델로 근사한다.
<img width="774" height="23" alt="image" src="https://github.com/user-attachments/assets/1569c1dc-410b-45b0-93ac-432543a41964" />

  - 여기서 각 계수는 그래디언트와 헤시안 정보를 내포하며, 국부적인 신호의 변화를 모델링한다. 이러한 방식은 무작위적으로 발생하는 고주파 노이즈인 물보라의 왜곡을 자연스럽게 평활화(Smoothing)하는 동시에, 선박의 전역적인 이동과 같은 저주파 신호는 정밀하게 보존하는 특성을 갖는다. 이는 대규모 학습 데이터 분포에 의존하는 RAFT와 달리 물리적 연산에 기반하므로, 데이터셋에 존재하지 않는 극한의 폭풍우 환경에서도 일관된 탐지 성능을 보장하는 근거가 된다.
  
- Dual-Stream 아키텍처 및 멀티스케일 특징 융합
<img width="282" height="271" alt="image" src="https://github.com/user-attachments/assets/3814a89e-d7fd-4eb4-841d-b90c55f4a005" />

  - 본 시스템은 정적 시각 정보와 동적 운동 정보를 분리하여 처리한 후 통합하는 이중 스트림 구조를 채택하였다.
  
  - 공간 인코더 역할을 수행하는 RGB 스트림은 YOLOv8s 백본을 통해 선체 및 구조물의 형태적 특징을 추출한다. 이와 병행되는 Flow 스트림은 2채널(dx, dy) 입력을 처리하도록 수정된 YOLOv8n 백본을 활용한다. 동적 특징은 복잡한 텍스처 정보보다 모션 그래디언트 포착이 중요하므로, Nano급 경량 모델만으로도 충분한 동역학적 정보를 추출할 수 있어 연산 효율을 극대화하였다.
  
  - 추출된 두 특징은 단순한 후처리가 아닌 신경망 내부의 세 단계 해상도(P3, P4, P5)에서 유기적으로 결합된다. P3(1/8 배율) 계층은 고해상도 정보를 유지하여 소형 객체 및 원거리 탐지에 집중하며, P4(1/16 배율)는 중간 크기 선박의 추적 최적화를 담당한다. 마지막으로 P5(1/32 배율) 계층은 대형 객체의 의미적(Semantic) 특징을 결합하여 탐지 신뢰도를 높인다. 각 융합 블록(Fusion Block)에서는 결합(Concatenation) 후 1x1 합성곱을 통해 채널 가중치를 재할당하며, 배취 정규화(Batch Normalization)와 SiLU 활성화 함수를 적용하여 극한 환경에서의 학습 안정성을 확보하였다.
  
## 3. 실현 가능성 및 발전 가능성
- 본 연구는 이론적 설계를 바탕으로 실제 모델 학습과 극한 환경 시뮬레이션을 수행하여 기술의 실전 배치 가능성을 검증하였다. 특히 제한된 자원 환경에서의 효율성과 악천후 상황에서의 탐지 신뢰도를 확보하는 데 주력하였다.
  
- 실험 환경 및 학습 프로토콜
  - 모델 학습은 NVIDIA RTX 3090(24GB) 환경에서 AMP(Automatic Mixed Precision) 가속 기술을 적용하여 수행되었다. 해상 선박 데이터셋을 8:2 비율로 분할하여 학습과 검증을 진행하였으며, AdamW 옵티마이저를 통해 가중치 감쇠(Weight Decay)를 조절하며 과적합을 방지하였다. 특히 실시간 추론의 물리적 타당성을 확보하기 위해 'Zero-Leakage Policy'를 엄격히 준수하였다. 이는 미래 시점의 정보 유입을 원천 차단하고 과거(t-1)와 현재(t) 프레임만을 활용하도록 강제함으로써, 실제 현장 배치 시 발생할 수 있는 데이터 왜곡 문제를 사전에 차단한 것이다.
  
- 단일 RGB(3ch) 대비 시공간 융합(5ch) 모델의 성능 검증
  - 본 연구에서는 제안하는 시공간 특징 융합 모델의 유효성을 검증하기 위해, 기존 단일 스트림 RGB 모델(3ch)과 제안 아키텍처(5ch) 간의 비교 실험을 수행하였다. 실험 결과, 극한의 물보라 노이즈 환경에서 두 모델은 탐지 정밀도와 안정성 측면에서 현격한 차이를 보였다.
  
- 극한 환경 대응: Heavy Storm 시뮬레이션
  - 가혹한 해상 상황에서의 강건성을 검증하기 위해 'Heavy Storm Mode' 증강 기법을 독자적으로 설계하였다. 먼저 수백 종의 물보라 패턴을 메모리에 캐싱하는 'Noise Bank' 기법을 도입하여, 학습 중 CPU 병목 현상을 해결하고 데이터 로드 효율을 극대화하였다. 또한 연속된 프레임에 서로 독립적인 노이즈를 적용하는 전략을 취하였다. 이는 모델이 무작위적인 노이즈 패턴을 객체의 이동으로 오인하지 않고, 물리적 연속성을 지닌 실제 객체의 이동 벡터만을 선별적으로 학습하도록 유도하는 핵심적인 역할을 하였다.
  
 - 결과 분석
  - 정량적 지표 분석 (mAP 성능 비교, 순서대로 3ch 및 4ch PR_curve)
    
    <img width="258" height="173" alt="image" src="https://github.com/user-attachments/assets/feaef369-db9a-4c0e-b3e0-26a7ec1353c0" />

    <img width="267" height="179" alt="image" src="https://github.com/user-attachments/assets/78461e70-fbd5-4f0d-a530-76c7d2391595" />

    - 먼저 Precision-Recall 곡선을 통해 정량적 성능을 분석한 결과, 3채널 모델의 경우 mAP@0.5 지표가 0.042에 머물러 사실상 객체 식별이 불가능한 수준임을 확인하였다. 이는 물보라 증강(Heavy Storm Mode) 노이즈가 RGB 채널의 시각적 특징을 완전히 왜곡했기 때문이다. 반면, 광학 흐름 정보를 결합한 5채널 융합 모델은 mAP@0.5 0.829를 기록하며, 극한의 노이즈 환경에서도 압도적인 탐지 성능을 유지함을 입증하였다.
  
  - 정성적 결과 및 오탐지 억제 효과
    - 실제 추론 이미지 분석(Inference Analysis)에서도 그 차이가 명확히 드러났다. 3채널 모델은 무작위로 확산되는 물보라 패턴을 객체로 오인하거나, 배경 소음으로 인해 실제 선박을 탐지하지 못하는 '미탐지' 현상이 빈번하게 발생하였다.
반면, 5채널 융합 모델은 Farneback 알고리즘을 통해 추출된 모션 벡터를 활용함으로써, 형태가 불분명한 노이즈 속에서도 일정한 방향성과 물리적 연속성을 지닌 실제 선박만을 정확히 필터링하여 바운딩 박스를 생성하였다. 특히 고주파 노이즈가 화면 전체를 덮는 상황에서도 박스의 떨림(Jitter) 현상이 현저히 감소하여 추적 안정성이 비약적으로 향상됨을 확인하였다.
  
## 4. 결론
- 본 연구는 해상 환경의 물리적 특성을 반영한 혁신적인 이중 스트림(Two-Stream) 아키텍처를 통해 기존 단일 프레임 탐지 방식의 고질적인 오탐지 한계를 극복하였다. Farneback 광학 흐름과 YOLOv8을 결합한 실시간 최적화 설계 그리고 극한 환경 시뮬레이션을 통한 검증은 본 시스템의 실전 배치 가능성을 충분히 입증하였다. 본 기술은 단순한 객체 인지를 넘어 안전한 해상 환경 조성과 해양 신산업 창출이라는 공익적·상업적 목표를 동시에 달성할 수 있는 실무적 솔루션임을 확신한다.
